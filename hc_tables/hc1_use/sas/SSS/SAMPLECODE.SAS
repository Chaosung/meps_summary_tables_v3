/****************************************************************************************************
* This is a test text file for displaying SAS code in shiny app.                                   *
*The select statistics to view can be Number of people, percent of population with an expense(%),  *
*Total expenditure($), Mean expenditure per person($), Mean expenditure per person with expense($).*
*The group by variable can be Age groups and Census region.                                        * 
****************************************************************************************************/

LIBNAME MEPS "C:\MEPS";

%MACRO YY (YEAR=,YR=,DATA=,VAR=,STAT=,DOMAIN=);

DATA PUF;
  SET MEPS.&DATA;
   
/*PICK ONE PART TO DISPLAY BASED ON THE VAR VARIABLE SELECTED IN THE Select statistic to view COLUMN*/
/*create VAR variable*/

  /*NUMBER OF PEOPLE*/
  IND=1; 
  
  /*MEAN POPULATION WITH AN EXPENSE*/
  IND=1
  SUB=2;
  IF TOTEXP GT 0 THEN SUB=1;
  
  /*TOTAL EXPENDITURES*/
  TOTEXP=TOTEXP&YR; 
  
  /*MEAN EXPENDITURE PER PERSON*/
  TOTEXP=TOTEXP&YR; 
  
  /*MEAN EXPENDITURE PER PERSON WITH expense*/
  TOTEXP=TOTEXP&YR; 
  SUB=2;
  IF TOTEXP GT 0 THEN SUB=1;
    

/*PICK ONE PART TO DISPLAY BASED ON THE DOMAIN VARIABLE SELECTED IN THE "GROUP BY" COLUMN*/
/*create domain variable*/
  /*AGE*/
  %IF &YEAR=1996 %THEN %DO;
       AGE53X=AGE2X;
       AGE42X=AGE2X;
       AGE31X=AGE1X;
  %END;
  
  IF AGE53X>=0 THEN AGELAST=AGE53X;
  ELSE IF AGE42X>=0 THEN AGELAST=AGE42X;
  ELSE IF AGE31X>=0 THEN AGELAST=AGE31X;
  
  IF 0 LE AGELAST LE 17 THEN AGEGRPS=1;
  ELSE IF 18 LE AGELAST LE 64 THEN AGEGRPS=2;
  ELSE IF AGELAST>64 THEN AGEGRPS=3;
  
  IF 0 LE AGELAST LE 4 THEN AGEGRPS_V2=1;
  ELSE IF 5 LE AGELAST LE 17 THEN AGEGRPS_V2=2;
  ELSE IF 18 LE AGELAST LE 44 THEN AGEGRPS_V2=3;
  ELSE IF 45 LE AGELAST LE 64 THEN AGEGRPS_V2=4;
  ELSE IF AGELAST>64 THEN AGEGRPS_V2=5;
  
  /*REGION*/
  %IF &YEAR=1996 %THEN %DO;
  REGION53=REGION3
  REGION42=REGION2;
  REGION31=REGION1;
  %END;
  
  IF REGION53 GE 0 THEN REGIONX=REGION53;
  ELSE IF REGION42 GE 0 THEN REGIONX=REGION42;
  ELSE IF REGION31 GE 0 THEN REGIONX=REGION31;
  
  IF REGIONX=1 THEN REGION="NORTHEAST";
  ELSE IF REGIONX=2 THEN REGION="MIDWEST";
  ELSE IF REGIONX=3 THEN REGION="SOUTH";
  ELSE IF REGIONX=4 THEN REGION="WEST";
  
/*domain variable end*/
RUN;

ODS LISTING CLOSE;
PROC SURVEYMEANS DATA=PUF &stat;
	VAR &var;
	STRATA VARSTR;
	CLUSTER VARPSU;
	WEIGHT PERWT14F;
	DOMAIN &domain;
	ODS OUTPUT DOMAIN=OUT1;
RUN;
ODS LISTING;

PROC PRINT DATA=OUT1;
RUN;
%MEND YY;

/*PICK ONE STATEMENT TO DISPLAY BASED ON THE COMBINATION SELECTED*/
  /*FOR THE COMBINAITON OF NUMBER OF PEOPLE AND GROUP BY*/
  %YY(YEAR=2014,YR=14,DATA=H171,VAR=IND,STAT=SUMWGT,DOMAIN=AGEGRPS);
  %YY(YEAR=2014,YR=14,DATA=H171,VAR=IND,STAT=SUMWGT,DOMAIN=REGION);
 
  
  /*FOR THE COMBINAITON OF PERCENT OF POPULATION WITH AN EXPENSE AND GROUP BY*/
  %YY(YEAR=2014,YR=14,DATA=H171,VAR=IND,STAT=MEAN,DOMAIN=SUB*AGEGRPS);
  %YY(YEAR=2014,YR=14,DATA=H171,VAR=IND,STAT=MEAN,DOMAIN=SUB*REGION);
 
  
  /*FOR THE COMBINAITON OF TOTAL EXPENDITURE AND GROUP BY*/
  %YY(YEAR=2014,YR=14,DATA=H171,VAR=TOTEXP,STAT=SUMWGT,DOMAIN=AGEGRPS);
  %YY(YEAR=2014,YR=14,DATA=H171,VAR=TOTEXP,STAT=SUMWGT,DOMAIN=REGION);
 
  /*FOR THE COMBINAITON OF MEAN EXPENDITURE PER PERSON AND GROUP BY*/
  %YY(YEAR=2014,YR=14,DATA=H171,VAR=TOTEXP,STAT=MEAN,DOMAIN=AGEGRPS)
  %YY(YEAR=2014,YR=14,DATA=H171,VAR=TOTEXP,STAT=MEAN,DOMAIN=REGION)
  
  
  /*FOR THE COMBINAITON OF MEAN EXPENDITURE PER PERSON WITH EXPENSE AND GROUP BY*/
  %YY(YEAR=2014,YR=14,DATA=H171,VAR=TOTEXP,STAT=MEAN,DOMAIN=SUB*AGEGRPS)
  %YY(YEAR=2014,YR=14,DATA=H171,VAR=TOTEXP,STAT=MEAN,DOMAIN=SUB*REGION)
 




